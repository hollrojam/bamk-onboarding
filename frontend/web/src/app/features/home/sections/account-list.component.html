@if (loading) {
  <div class="loading">
    <div>Cargando cuentas...</div>
    <div class="skeleton">
      @for (_ of skeletonRows; track _) {
        <div class="skeleton-row"></div>
      }
    </div>
  </div>
}

@if (!loading && accounts.length === 0) {
  <div class="empty">No hay cuentas para el cliente</div>
}

@if (!loading && accounts.length > 0) {
  <div class="card">
    <div class="table-header">
      <h3 class="section-title">Account List</h3>
      <div class="sorters">
        <button
          class="btn-secondary"
          type="button"
          (click)="onSort('customer')"
          [attr.aria-sort]="sortAria('customer')"
        >Ordenar por cliente</button>
        <button
          class="btn-secondary"
          type="button"
          (click)="onSort('tipo')"
          [attr.aria-sort]="sortAria('tipo')"
        >Ordenar por tipo</button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table" role="table" aria-label="Lista de cuentas">
        <thead>
          <tr role="row">
            <th role="columnheader" scope="col">Nombre completo</th>
            <th role="columnheader" scope="col">Tipo de cuenta</th>
            <th role="columnheader" scope="col">Saldo</th>
            <th role="columnheader" scope="col">Estado</th>
          </tr>
        </thead>
        <tbody>
          @for (account of sortedAccounts(); track trackByAccount($index, account)) {
            <tr role="row" class="row">
              <td role="cell">
                <div class="primary">{{ customerName || "Sin cliente" }}</div>
                <div class="secondary">{{ account.accountNumber }}</div>
              </td>
              <td role="cell">{{ getAccountTypeLabel(account.tipo) }}</td>
              <td role="cell">{{ formatBalance(account.saldoActual) }}</td>
              <td role="cell">
                <mat-slide-toggle
                  class="status-toggle"
                  [class.is-loading]="isUpdating(account.accountNumber)"
                  [checked]="account.estado === 'ACTIVE'"
                  [disabled]="isUpdating(account.accountNumber)"
                  (change)="onToggleChange($event, account)"
                  labelPosition="after"
                  [attr.aria-label]="'Cambiar estado de ' + account.accountNumber + ' a ' + (account.estado === 'ACTIVE' ? 'inactiva' : 'activa')"
                >
                  {{ statusLabel(account.estado) }}
                </mat-slide-toggle>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    @if (updatingAccountNumbers.size > 0) {
      <div class="skeleton">
        @for (_ of skeletonRows; track _) {
          <div class="skeleton-row"></div>
        }
      </div>
    }
  </div>
}
